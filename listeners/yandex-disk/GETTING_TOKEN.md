# –ü–æ–ª—É—á–µ–Ω–∏–µ OAuth —Ç–æ–∫–µ–Ω–∞ –¥–ª—è –Ø–Ω–¥–µ–∫—Å –î–∏—Å–∫ API

–≠—Ç–æ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ–º–æ–∂–µ—Ç –≤–∞–º –ø–æ–ª—É—á–∏—Ç—å OAuth —Ç–æ–∫–µ–Ω –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –Ø–Ω–¥–µ–∫—Å –î–∏—Å–∫ API.

## –°–ø–æ—Å–æ–± 1: –ß–µ—Ä–µ–∑ –Ø–Ω–¥–µ–∫—Å ID (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

### –®–∞–≥ 1: –°–æ–∑–¥–∞–Ω–∏–µ OAuth –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ [–Ø–Ω–¥–µ–∫—Å ID](https://oauth.yandex.ru/)
2. –í–æ–π–¥–∏—Ç–µ –≤ —Å–≤–æ–π –∞–∫–∫–∞—É–Ω—Ç –Ø–Ω–¥–µ–∫—Å
3. –ù–∞–∂–º–∏—Ç–µ **"–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ"** –∏–ª–∏ **"–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ"**

### –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

–ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É:

- **–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è**: `Mysogatone LISTENER` (–∏–ª–∏ –ª—é–±–æ–µ –¥—Ä—É–≥–æ–µ)
- **–ü–ª–∞—Ç—Ñ–æ—Ä–º—ã**: –í—ã–±–µ—Ä–∏—Ç–µ **"–í–µ–±-—Å–µ—Ä–≤–∏—Å—ã"**
- **Callback URI**: `http://localhost:8080/oauth` (–∏–ª–∏ –ª—é–±–æ–π –¥—Ä—É–≥–æ–π URL –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
- **–ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞**: –í—ã–±–µ—Ä–∏—Ç–µ:
  - ‚úÖ **cloud_api:disk.read** - —á—Ç–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤
  - ‚úÖ **cloud_api:disk.write** - –∑–∞–ø–∏—Å—å —Ñ–∞–π–ª–æ–≤
  - ‚úÖ **cloud_api:disk.app_folder** - –¥–æ—Å—Ç—É–ø –∫ –ø–∞–ø–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### –®–∞–≥ 3: –ü–æ–ª—É—á–µ–Ω–∏–µ Client ID –∏ Client Secret

–ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤—ã –ø–æ–ª—É—á–∏—Ç–µ:
- **Client ID** (ID –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è)
- **Client Secret** (–ü–∞—Ä–æ–ª—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è)

**–í–∞–∂–Ω–æ:** –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ–º –º–µ—Å—Ç–µ!

### –®–∞–≥ 4: –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ —á–µ—Ä–µ–∑ OAuth flow

#### –í–∞—Ä–∏–∞–Ω—Ç A: –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Å–ø–æ—Å–æ–± (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)

1. –û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ —Å–ª–µ–¥—É—é—â–∏–π URL (–∑–∞–º–µ–Ω–∏—Ç–µ `YOUR_CLIENT_ID` –Ω–∞ –≤–∞—à Client ID):

```
https://oauth.yandex.ru/authorize?response_type=token&client_id=YOUR_CLIENT_ID
```

2. –†–∞–∑—Ä–µ—à–∏—Ç–µ –¥–æ—Å—Ç—É–ø –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é –∫ –Ø–Ω–¥–µ–∫—Å –î–∏—Å–∫—É
3. –ü–æ—Å–ª–µ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–æ–∫–µ–Ω –±—É–¥–µ—Ç –≤ URL –≤ –ø–∞—Ä–∞–º–µ—Ç—Ä–µ `access_token`:

```
http://localhost:8080/oauth#access_token=YOUR_TOKEN&token_type=bearer&expires_in=31536000
```

–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ `access_token` - —ç—Ç–æ –≤–∞—à —Ç–æ–∫–µ–Ω!

#### –í–∞—Ä–∏–∞–Ω—Ç B: –ß–µ—Ä–µ–∑ —Å–∫—Ä–∏–ø—Ç (–∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è)

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `scripts/get-token.ts`:

```typescript
#!/usr/bin/env -S deno run --allow-net --allow-read --allow-env

const CLIENT_ID = Deno.env.get("YANDEX_CLIENT_ID") || Deno.args[0];
const CLIENT_SECRET = Deno.env.get("YANDEX_CLIENT_SECRET") || Deno.args[1];

if (!CLIENT_ID) {
  console.error("–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: deno run --allow-net scripts/get-token.ts CLIENT_ID CLIENT_SECRET");
  console.error("–ò–ª–∏ —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:");
  console.error("  export YANDEX_CLIENT_ID=your_client_id");
  console.error("  export YANDEX_CLIENT_SECRET=your_client_secret");
  Deno.exit(1);
}

const authUrl = `https://oauth.yandex.ru/authorize?response_type=code&client_id=${CLIENT_ID}`;
console.log("\nüìã –û—Ç–∫—Ä–æ–π—Ç–µ —ç—Ç–æ—Ç URL –≤ –±—Ä–∞—É–∑–µ—Ä–µ:");
console.log(authUrl);
console.log("\n–ü–æ—Å–ª–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –≤—ã –±—É–¥–µ—Ç–µ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω—ã –Ω–∞ callback URL.");
console.log("–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∫–æ–¥ –∏–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ 'code' –≤ URL –∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –µ–≥–æ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞.\n");
```

## –°–ø–æ—Å–æ–± 2: –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ —á–µ—Ä–µ–∑ –∫–æ–¥ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

### –®–∞–≥ 1: –ü–æ–ª—É—á–∏—Ç–µ –∫–æ–¥ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

–û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ (–∑–∞–º–µ–Ω–∏—Ç–µ `YOUR_CLIENT_ID`):

```
https://oauth.yandex.ru/authorize?response_type=code&client_id=YOUR_CLIENT_ID
```

–ü–æ—Å–ª–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –≤—ã –±—É–¥–µ—Ç–µ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω—ã –Ω–∞ –≤–∞—à callback URL —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º `code`.

### –®–∞–≥ 2: –û–±–º–µ–Ω—è–π—Ç–µ –∫–æ–¥ –Ω–∞ —Ç–æ–∫–µ–Ω

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–ª–µ–¥—É—é—â–∏–π –∑–∞–ø—Ä–æ—Å (–∑–∞–º–µ–Ω–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏—è):

```bash
curl -X POST https://oauth.yandex.ru/token \
  -d "grant_type=authorization_code" \
  -d "code=YOUR_AUTHORIZATION_CODE" \
  -d "client_id=YOUR_CLIENT_ID" \
  -d "client_secret=YOUR_CLIENT_SECRET"
```

–û—Ç–≤–µ—Ç –±—É–¥–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å `access_token`.

## –°–ø–æ—Å–æ–± 3: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≥–æ—Ç–æ–≤–æ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞

–Ø —Å–æ–∑–¥–∞–º —Å–∫—Ä–∏–ø—Ç –¥–ª—è —É–ø—Ä–æ—â–µ–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞.

## –•—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ

**–ù–ï –∫–æ–º–º–∏—Ç—å—Ç–µ —Ç–æ–∫–µ–Ω –≤ git!**

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ–¥–∏–Ω –∏–∑ —Å–ø–æ—Å–æ–±–æ–≤:

1. **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è** (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):
   ```bash
   export YANDEX_DISK_TOKEN=your_token_here
   ```

2. **–§–∞–π–ª .env** (–¥–æ–±–∞–≤—å—Ç–µ –≤ .gitignore):
   ```bash
   echo "YANDEX_DISK_TOKEN=your_token_here" > .env
   ```

3. **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª** (–Ω–µ –∫–æ–º–º–∏—Ç—å—Ç–µ):
   ```json
   {
     "yandexDiskToken": "your_token_here"
   }
   ```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞

–ü–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –µ–≥–æ:

```bash
deno task health YOUR_TOKEN
```

## –°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è —Ç–æ–∫–µ–Ω–∞

- **–í—Ä–µ–º–µ–Ω–Ω—ã–π —Ç–æ–∫–µ–Ω** (—á–µ—Ä–µ–∑ `response_type=token`): –æ–±—ã—á–Ω–æ 1 –≥–æ–¥
- **–ü–æ—Å—Ç–æ—è–Ω–Ω—ã–π —Ç–æ–∫–µ–Ω**: –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å —á–µ—Ä–µ–∑ refresh token

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞

–ï—Å–ª–∏ —Ç–æ–∫–µ–Ω –∏—Å—Ç–µ–∫, –ø–æ–ª—É—á–∏—Ç–µ –Ω–æ–≤—ã–π —á–µ—Ä–µ–∑ —Ç–æ—Ç –∂–µ –ø—Ä–æ—Ü–µ—Å—Å.

## Troubleshooting

### –û—à–∏–±–∫–∞: "Invalid client"

- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å Client ID –∏ Client Secret
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–æ –∏ –∞–∫—Ç–∏–≤–Ω–æ

### –û—à–∏–±–∫–∞: "Invalid grant"

- –ö–æ–¥ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –º–æ–∂–µ—Ç –±—ã—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑
- –ö–æ–¥ –º–æ–∂–µ—Ç –∏—Å—Ç–µ—á—å (–æ–±—ã—á–Ω–æ –¥–µ–π—Å—Ç–≤—É–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç)
- –ü–æ–ª—É—á–∏—Ç–µ –Ω–æ–≤—ã–π –∫–æ–¥ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

### –û—à–∏–±–∫–∞: "Access denied"

- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤—ã –≤—ã–±—Ä–∞–ª–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ä–∞–∑—Ä–µ—à–∏–ª –¥–æ—Å—Ç—É–ø

### –û—à–∏–±–∫–∞: "Invalid token"

- –¢–æ–∫–µ–Ω –º–æ–∂–µ—Ç –∏—Å—Ç–µ—á—å
- –ü–æ–ª—É—á–∏—Ç–µ –Ω–æ–≤—ã–π —Ç–æ–∫–µ–Ω

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –Ø–Ω–¥–µ–∫—Å OAuth](https://yandex.com/dev/id/doc/ru/)
- [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –Ø–Ω–¥–µ–∫—Å –î–∏—Å–∫ API](https://yandex.com/dev/disk/api/concepts/about.html)
- [–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è OAuth](https://yandex.com/dev/id/doc/ru/yandex-id/quick-start)

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

1. –°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ [oauth.yandex.ru](https://oauth.yandex.ru/)
2. –ü–æ–ª—É—á–∏—Ç–µ Client ID –∏ Client Secret
3. –û—Ç–∫—Ä–æ–π—Ç–µ URL –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –≤ –±—Ä–∞—É–∑–µ—Ä–µ:
   ```
   https://oauth.yandex.ru/authorize?response_type=token&client_id=YOUR_CLIENT_ID
   ```
4. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ç–æ–∫–µ–Ω –∏–∑ URL –ø–æ—Å–ª–µ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è
5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–æ–∫–µ–Ω:
   ```bash
   deno task health YOUR_TOKEN
   ```

