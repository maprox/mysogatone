# LISTENER –¥–ª—è –Ø–Ω–¥–µ–∫—Å –î–∏—Å–∫

–°–µ—Ä–≤–µ—Ä –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ, –∫–æ—Ç–æ—Ä—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç –Ø–Ω–¥–µ–∫—Å –î–∏—Å–∫ –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ.

## –û–ø–∏—Å–∞–Ω–∏–µ

LISTENER –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ –Ø–Ω–¥–µ–∫—Å –î–∏—Å–∫ –∞–∫–∫–∞—É–Ω—Ç—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ API –∏:
- –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–π –ø–∞–ø–∫–µ –Ω–∞ –Ø–Ω–¥–µ–∫—Å –î–∏—Å–∫–µ
- –û–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ (–ø–∞–ø–∫–∏/—Ñ–∞–π–ª—ã)
- –ü–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ —Ü–µ–ª–µ–≤–æ–º—É —Å–µ—Ä–≤–µ—Ä—É (GOAL)
- –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç –æ—Ç–≤–µ—Ç—ã –æ—Ç GOAL –≤ –Ø–Ω–¥–µ–∫—Å –î–∏—Å–∫ –ø–∞–ø–∫—É —á–µ—Ä–µ–∑ API

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Deno runtime
- OAuth —Ç–æ–∫–µ–Ω –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –Ø–Ω–¥–µ–∫—Å –î–∏—Å–∫ API

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (–µ—Å–ª–∏ –µ—Å—Ç—å Client ID)

1. –û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ (–∑–∞–º–µ–Ω–∏—Ç–µ `YOUR_CLIENT_ID`):
   ```
   https://oauth.yandex.ru/authorize?response_type=token&client_id=YOUR_CLIENT_ID
   ```
2. –†–∞–∑—Ä–µ—à–∏—Ç–µ –¥–æ—Å—Ç—É–ø
3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ç–æ–∫–µ–Ω –∏–∑ URL: `access_token=–í–ê–®_–¢–û–ö–ï–ù`
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–æ–∫–µ–Ω:
   ```bash
   deno task health –í–ê–®_–¢–û–ö–ï–ù
   ```

**–ì–æ—Ç–æ–≤–æ!** –¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å.

üìñ –ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è: [QUICK_START.md](QUICK_START.md) –∏–ª–∏ [GETTING_TOKEN.md](GETTING_TOKEN.md)

## –ó–∞–ø—É—Å–∫

```bash
deno task start
```

–ò–ª–∏ –Ω–∞–ø—Ä—è–º—É—é:

```bash
deno run --allow-net --allow-read --allow-write src/main.ts
```

## –õ–∏–Ω—Ç–∏–Ω–≥ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞

–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞ –ª–∏–Ω—Ç–µ—Ä–æ–º:

```bash
deno task lint
```

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º:

```bash
deno task lint:fix
```

–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤ –∏ –ª–∏–Ω—Ç–∏–Ω–≥:

```bash
deno task check
```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤:

```bash
deno task test
```

–ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –≤ —Ä–µ–∂–∏–º–µ watch (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö):

```bash
deno task test:watch
```

–ó–∞–ø—É—Å–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Ñ–∞–π–ª–∞:

```bash
deno test --allow-net --allow-read --allow-write tests/utils_test.ts
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤

–¢–µ—Å—Ç—ã –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ –ø–∞–ø–∫–µ `tests/`:
- `utils_test.ts` - —Ç–µ—Å—Ç—ã –¥–ª—è —É—Ç–∏–ª–∏—Ç (–Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –ø—É—Ç–µ–π, –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ URL, –∑–∞–¥–µ—Ä–∂–∫–∏)
- `errors_test.ts` - —Ç–µ—Å—Ç—ã –¥–ª—è –∫–ª–∞—Å—Å–æ–≤ –æ—à–∏–±–æ–∫
- `file-operations_test.ts` - —Ç–µ—Å—Ç—ã –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–π —Å —Ñ–∞–π–ª–∞–º–∏
- `http-client_test.ts` - —Ç–µ—Å—Ç—ã –¥–ª—è HTTP –∫–ª–∏–µ–Ω—Ç–∞ –∏ retry –ª–æ–≥–∏–∫–∏
- `yandex-disk-provider_test.ts` - —Ç–µ—Å—Ç—ã –¥–ª—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
- `test_runner.ts` - –≥–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

### –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–±–µ–∑ —Ä–µ–∞–ª—å–Ω–æ–≥–æ API)

–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∏–º–ø–æ—Ä—Ç—ã, —Ç–∏–ø—ã –∏ –±–∞–∑–æ–≤—É—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:

```bash
deno task verify
```

–ò–ª–∏ –Ω–∞–ø—Ä—è–º—É—é:

```bash
deno run --allow-net --allow-read --allow-write scripts/verify-setup.ts
```

### –ü–æ–ª–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å —Ä–µ–∞–ª—å–Ω—ã–º API

–ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å —Å —Ä–µ–∞–ª—å–Ω—ã–º –Ø–Ω–¥–µ–∫—Å –î–∏—Å–∫ API. –¢—Ä–µ–±—É–µ—Ç OAuth —Ç–æ–∫–µ–Ω.

```bash
# –ß–µ—Ä–µ–∑ –∞—Ä–≥—É–º–µ–Ω—Ç –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏
deno task health [YOUR_TOKEN]

# –ò–ª–∏ —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è
export YANDEX_DISK_TOKEN=your_token
deno task health
```

–ò–ª–∏ –Ω–∞–ø—Ä—è–º—É—é:

```bash
deno run --allow-net --allow-read --allow-env scripts/check-health.ts [YOUR_TOKEN]
```

–°–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
- ‚úÖ –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Ñ–∞–π–ª–æ–≤
- ‚úÖ –ó–∞–≥—Ä—É–∑–∫—É —Ñ–∞–π–ª–∞
- ‚úÖ –°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞
- ‚úÖ –£–¥–∞–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–∞

### –ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

–ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ:

```bash
# 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
deno task verify

# 2. –õ–∏–Ω—Ç–∏–Ω–≥
deno task lint

# 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤
deno task check

# 4. –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
deno task test

# 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å —Ä–µ–∞–ª—å–Ω—ã–º API (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
deno task health [YOUR_TOKEN]
```

### –û—Ç–ª–∞–¥–∫–∞ –ø—Ä–æ–±–ª–µ–º

–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫—É –ø—Ä–æ–µ–∫—Ç–∞:**
   ```bash
   deno task verify
   ```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–∏–Ω—Ç–∏–Ω–≥:**
   ```bash
   deno task lint
   ```

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–∏–ø—ã:**
   ```bash
   deno task check
   ```

4. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç—ã:**
   ```bash
   deno task test
   ```

5. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å —Ä–µ–∞–ª—å–Ω—ã–º API (–µ—Å–ª–∏ –µ—Å—Ç—å —Ç–æ–∫–µ–Ω):**
   ```bash
   deno task health [YOUR_TOKEN]
   ```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞

- `main.ts` - –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- `storage-provider/` - –ú–æ–¥—É–ª—å StorageProvider –¥–ª—è –Ø–Ω–¥–µ–∫—Å –î–∏—Å–∫ API
  - `types.ts` - –¢–∏–ø—ã –∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã
  - `errors.ts` - –ö–ª–∞—Å—Å—ã –æ—à–∏–±–æ–∫
  - `utils.ts` - –£—Ç–∏–ª–∏—Ç—ã
  - `http-client.ts` - HTTP –∫–ª–∏–µ–Ω—Ç —Å retry –º–µ—Ö–∞–Ω–∏–∑–º–æ–º
  - `file-operations.ts` - –û–ø–µ—Ä–∞—Ü–∏–∏ —Å —Ñ–∞–π–ª–∞–º–∏
  - `yandex-disk-provider.ts` - –û—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞—Å—Å –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
  - `index.ts` - –ü—É–±–ª–∏—á–Ω—ã–π API –º–æ–¥—É–ª—è
- `monitor.ts` - Polling –º–µ—Ö–∞–Ω–∏–∑–º –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- `connection-handler.ts` - –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –∫ —Ü–µ–ª–µ–≤—ã–º —Å–µ—Ä–≤–µ—Ä–∞–º

## –ü—Ä–æ—Ç–æ–∫–æ–ª –æ–±–º–µ–Ω–∞

–§–æ—Ä–º–∞—Ç –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –æ—Ç–≤–µ—Ç–æ–≤ –æ–ø–∏—Å–∞–Ω –≤ [shared/protocol/PROTOCOL.md](../../shared/protocol/PROTOCOL.md).

–ü—Ä–æ—Ç–æ–∫–æ–ª –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ñ–∞–π–ª—ã –≤ –æ–±–ª–∞—á–Ω–æ–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ:
- `requests/{requestId}.req` - –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å–∞ (JSON)
- `requests/{requestId}.chunk.N` - —á–∞–Ω–∫–∏ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞ GOAL (binary, –≥–¥–µ N - –Ω–æ–º–µ—Ä —á–∞–Ω–∫–∞)
- `requests/{requestId}.ready` - —Ñ–∞–π–ª-–º–∞—Ä–∫–µ—Ä –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏ (JSON: {totalChunks, totalBytes})
- `responses/{requestId}.resp` - –æ—Ç–≤–µ—Ç –æ—Ç GOAL (binary)
- `responses/{requestId}.error` - –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ (JSON)

